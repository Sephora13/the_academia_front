<div class="page">

  <section class="form-and-result-wrapper">
    <div class="form-title-container">
      <h1 class="form-title">ğŸ“˜ CrÃ©er une Ã©preuve avec lâ€™IA</h1>
    </div>

    <div class="form-content-scrollable">
        <p class="form-subtitle">
          Remplissez ce formulaire pour gÃ©nÃ©rer automatiquement une Ã©preuve complÃ¨te avec une grille de correction.
        </p>

        <form class="form-grid">
          <div class="field">
            <label for="matiere">ğŸ“š MatiÃ¨re</label>
            <input id="matiere" type="text" placeholder="Ex: MathÃ©matiques" [(ngModel)]="matiere" name="matiere" />
          </div>

          <div class="field">
            <label for="niveau">ğŸ·ï¸ Niveau</label>
            <input id="niveau" type="text" placeholder="Ex: Terminale" [(ngModel)]="niveau" name="niveau" />
          </div>

          <div class="field">
            <label for="exercices">ğŸ“ Nombre dâ€™exercices</label>
            <input id="exercices" type="number" min="1" placeholder="0" [(ngModel)]="nombreExercices" name="exercices" />
          </div>

          <div class="field">
            <label for="duree">â³ DurÃ©e (Ex: 2h30min)</label>
            <input id="duree" type="text" min="1" placeholder="Ex: 2h30min" [(ngModel)]="duree" name="duree" />
          </div>

          <div class="field full-width">
            <label for="objectifs">ğŸ¯ Objectifs d'apprentissage (un par ligne)</label>
            <textarea id="objectifs" placeholder="Ex: Comprendre les notions de base de l'ordinateur" [(ngModel)]="objectifsInput" name="objectifs"></textarea>
          </div>

           <div class="field full-width">
            <label for="initialPrompt">âœ¨ Instructions spÃ©cifiques pour la gÃ©nÃ©ration</label>
            <textarea id="initialPrompt" placeholder="Ex: Pour l'exercice 1 je veux 10 qcms..." [(ngModel)]="initialPrompt" name="initialPrompt"></textarea>
          </div>


          <div class="field file-field full-width">
            <label for="cours">ğŸ“ Document de cours (PDF)</label>
            <input id="cours" type="file" accept=".pdf" (change)="onFileChange($event)" />
          </div>
        </form>

        <button class="generate-btn" (click)="genererEpreuve()" [disabled]="generateButtonDisabled">
          ğŸš€ GÃ©nÃ©rer lâ€™Ã©preuve
        </button>

        <div *ngIf="isLoading" class="loader-container">
          <div class="loader"></div>
          <p>â³ GÃ©nÃ©ration de l'Ã©preuve en cours... Patientez un moment.</p>
        </div>

        <div *ngIf="showResult" class="generated-epreuve">
          <h3>ğŸ“„ Ã‰preuve GÃ©nÃ©rÃ©e :</h3>
          <pre>{{ epreuveGeneree }}</pre>

          <h3>ğŸ—’ï¸ Grille de Correction :</h3>
          <pre>{{ grilleCorrection }}</pre>
        </div>
    </div>

  </section>

  <section class="chat-wrapper">
    <header class="chat-header">
      <span class="bot-sticker" aria-hidden="false">ğŸ¤–</span>
      <h2>CrÃ©ons votre Ã©preuve ensemble</h2>
    </header>

    <div class="chat-body" #chatBody>
      <div *ngFor="let message of messages" class="bubble" [class.bot]="message.sender === 'bot'" [class.user]="message.sender === 'user'" [class.long]="message.isLong">
         {{ message.text }}
       </div>
    </div>

    <div class="chat-actions">
       <div class="chat-input-container">
          <input type="text" placeholder="Envoyez un message ou une suggestionâ€¦" [(ngModel)]="nouvelleSuggestion" (keyup.enter)="modifierEpreuve()" />
           <button class="send-btn" aria-label="Envoyer" (click)="modifierEpreuve()" [disabled]="!chatButtonsEnabled">â¤</button>
       </div>
    </div>

     <button class="save-btn-floating" (click)="enregistrerEpreuve()" [disabled]="!chatButtonsEnabled">ğŸ’¾ Enregistrer l'Ã©preuve</button>

  </section>
</div>
