<div class="page">

  <section class="form-and-result-wrapper">
    <div class="form-wrapper">
      <h1 class="form-title">Créer une épreuve a l’aide de l’IA</h1>
      <p class="form-subtitle">
        Veuillez remplir ce formulaire afin de me renseigner les informations nécessaires pour
        la génération de votre épreuve
      </p>

      <form class="form-grid">
        <div class="field">
          <label for="matiere">Matière</label>
          <input id="matiere" type="text" placeholder="Matière" [(ngModel)]="matiere" name="matiere" />
        </div>

        <div class="field">
          <label for="niveau">Niveau</label>
          <input id="niveau" type="text" placeholder="Niveau" [(ngModel)]="niveau" name="niveau" />
        </div>

        <div class="field">
          <label for="exercices">Nombres d’exercices</label>
          <input id="exercices" type="number" min="1" placeholder="0" [(ngModel)]="nombreExercices" name="exercices" />
        </div>

        <div class="field">
          <label for="duree">Durée</label>
          <input id="duree" type="number" min="1" placeholder="min" [(ngModel)]="duree" name="duree" />
        </div>

        <div class="field file-field">
          <label for="cours">Uploader le document de cours (pdf)</label>
          <input id="cours" type="file" accept=".pdf" (change)="onFileChange($event)" />
        </div>
      </form>

      <button class="generate-btn" (click)="genererEpreuve()">
         Générer l’épreuve
      </button>

      <div *ngIf="isLoading" class="loader-container">
        <div class="loader"></div>
        <p>Génération de l'épreuve en cours...</p>
      </div>

      <div *ngIf="showResult" class="generated-epreuve">
        <h3>Épreuve Générée :</h3>
        <pre>{{ epreuveGeneree }}</pre>

        <h3>Grille de Correction :</h3>
        <pre>{{ grilleCorrection }}</pre>
      </div>

    </div>
  </section>

  <section class="chat-wrapper">

    <header class="chat-header">
      <span class="bot-sticker" aria-hidden="false"></span>
      <h2>Créons ensemble votre épreuve</h2>
    </header>

    <div class="chat-body" #chatBody> <div class="bubble bot">Bonjour. Veuillez remplir le formulaire</div>
      <div *ngFor="let message of messages" [ngClass]="{'bubble bot': message.sender === 'bot', 'bubble user': message.sender === 'user', 'long': message.isLong}">
         {{ message.text }}
       </div>
    </div>

    <div class="chat-actions">
       <div class="chat-input-container">
          <input type="text" placeholder="Write your message…" [(ngModel)]="nouvelleSuggestion" (keyup.enter)="modifierEpreuve()" />
          <button class="send-btn" aria-label="Envoyer" (click)="modifierEpreuve()">➤</button>
       </div>
    </div>

     <button class="save-btn-floating" (click)="enregistrerEpreuve()">Enregistrer Epreuve</button>

  </section>
</div>